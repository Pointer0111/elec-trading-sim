# 电力市场模拟练习软件设计文档

## 一、引言

### 1.1 文档目的

本文档基于安大略能源委员会（OEB）“Market Renewal Training Course” 的 10 个 “Pool Market” 练习场景，明确课堂模拟软件的设计规范，包括功能模块、场景逻辑、可视化输出及技术要求，确保软件能精准复现电力市场机制，通过交互式可视化帮助学生理解市场定价、约束条件及效率优化逻辑。

### 1.2 应用场景

软件用于高校电力市场课程的课堂模拟，支持教师组织 10 个梯度化场景练习，学生通过扮演 “卖家”“买家”“系统运营商” 参与交易，实时观察市场结果（如清算价格、利润分配、约束影响），最终掌握电力市场设计的核心原理。

### 1.3 核心价值

- **场景还原**：精准复现 10 个练习的规则（定价机制、约束条件、成本结构等），确保模拟结果与理论逻辑一致。
- **可视化赋能**：通过图表动态展示抽象概念（如区域边际价格、成本回收保证），降低理解门槛。
- **交互体验**：支持实时操作（报价提交、参数调整）与结果反馈，增强课堂参与感。

## 二、总体设计

### 2.1 系统架构

采用 “前端交互层 + 核心逻辑层 + 数据存储层” 三层架构，确保模块解耦与可扩展性：

- **前端交互层**：Web 端界面（支持 PC / 平板），负责用户操作、可视化渲染、实时反馈。
- **核心逻辑层**：后端服务（Python/Node.js），实现 10 个场景的规则计算（清算价格、调度逻辑、利润核算等）。
- **数据存储层**：本地数据库（如 SQLite），存储课堂会话、用户操作、交易记录及结果数据，支持复盘。

### 2.2 技术栈

- **前端**：HTML5+CSS3+JavaScript（框架：React/Vue），可视化库（ECharts/D3.js），支持动态图表与响应式布局。
- **后端**：Python（Flask/Django）或 Node.js（Express），处理并发请求与规则计算。
- **部署**：支持本地部署（课堂局域网）或云端部署（轻量化服务器），确保离线可用。

## 三、功能需求

### 3.1 用户管理模块

#### 3.1.1 角色与权限

| 角色               | 权限描述                                                     |
| ------------------ | ------------------------------------------------------------ |
| 教师（管理员）     | 创建课堂会话、配置场景参数、分配学生角色、控制练习进度、导出结果数据。 |
| 学生（卖家）       | 查看自身边际成本 / 固定成本、提交报价、查看交易结果与利润。  |
| 学生（买家）       | 查看自身最高支付意愿、选择交易方式（如接受报价）、查看成本支出。 |
| 系统运营商（可选） | 查看全局供需数据、触发约束条件（如输电容量限制）、确认市场清算结果。 |

#### 3.1.2 会话管理

- 教师创建 “课堂会话” 时需指定场景编号（1-10），系统自动加载对应场景的默认参数（可手动修改）。
- 学生通过 “会话码” 加入，教师为其分配唯一角色 ID（如 “卖家 S1”“买家 B2”），角色信息与场景参数绑定。

### 3.2 场景配置模块

#### 3.2.1 通用参数配置

支持教师对每个场景的核心变量进行调整，生成自定义练习方案，参数包括：

- **需求参数**：高峰 / 非高峰时段划分、需求值及概率分布（如场景 1 的 “非高峰需求 2MW/3MW/4MW，概率 0.2/0.6/0.2”）。
- **卖家参数**：边际成本（MC）范围、固定成本（启动成本 / 最小运行时间，场景 6-8）、区域分布（场景 3-5 的东西区划分）、outage 概率（场景 9）。
- **约束参数**：输电容量（场景 3-5）、价格上限（场景 10）、市场力 mitigation 规则（场景 7-8）。

#### 3.2.2 场景模板库

系统内置 10 个场景的默认参数模板，教师可一键复用或基于模板修改，示例如下：

| 场景编号      | 核心模板参数                                                 |
| ------------- | ------------------------------------------------------------ |
| 3（输电约束） | 西区卖家：S1 (MC=20)、S2 (MC=25)；东区卖家：S3 (MC=40)、S4 (MC=50)；输电容量 = 3MW |
| 6（固定成本） | 非快速启动卖家：启动成本 = 50，最小运行时间时段；快速启动卖家： |

### 3.3 交易引擎模块

#### 3.3.1 核心计算逻辑

根据场景规则实时处理交易流程，输出关键结果：

- **价格计算**：单一清算价（场景 1）、按报价付费（场景 2）、区域边际价格 LMP（场景 5）、两阶段结算（场景 10）等。
- **调度逻辑**：低成本优先（场景 1）、输电约束下的区域调度（场景 3）、多时段优化（场景 8）等。
- **利润核算**：卖家利润 = 收入 - 成本（含固定成本分摊）、买家成本 = 支付价格总和、消费者剩余 / 生产者剩余（场景 1-2）。

#### 3.3.2 规则适配示例

| 场景               | 计算逻辑示例                                                 |
| ------------------ | ------------------------------------------------------------ |
| 场景 4（CMSC）     | 约束开启卖家收入 = MCP + (报价 - MCP)；约束关闭卖家收入 = MCP + (MCP - 报价) |
| 场景 7（成本回收） | 补贴金额 = max (0, 启动成本 - 总利润)；最终利润 = 总利润 + 补贴 |

### 3.4 可视化输出模块

#### 3.4.1 通用可视化组件

- **实时看板**：显示当前场景编号、需求值、清算价格、已完成交易数等关键指标，支持教师实时监控。
- **交互控件**：报价滑块（卖家输入报价）、需求调整按钮（教师修改参数）、结果筛选器（按角色 / 时段查看数据）。

#### 3.4.2 场景专属可视化（按场景分述）

| 场景编号 | 核心可视化内容                                               | 图表类型        | 交互设计                                                     |
| -------- | ------------------------------------------------------------ | --------------- | ------------------------------------------------------------ |
| 1        | 供需曲线与清算点（X 轴：发电量，Y 轴：价格；标记 MCP 及被调度区间） | 折线图 + 标记点 | 悬停显示卖家 MC 与报价；点击 MCP 点查看详细计算过程          |
| 2        | 单一价格 vs 按报价付费的利润对比（分组展示卖家收入）         | 分组柱状图      | 切换 “卖家视角”/“买家视角”，显示对应利润 / 成本差异          |
| 3        | 区域地图（西区 / 东区）+ 输电线路（标注容量）+ 被约束卖家标记（红色叉号 / 黄色感叹号） | 地图 + 图标     | 点击输电线路显示实时传输量；拖拽调整容量值，动态更新调度结果 |
| 4        | 消费者成本构成（基础电费 vs CMSC 补贴）                      | 饼图            | 点击饼图分区显示明细（如某卖家的 CMSC 金额）                 |
| 5        | 东西区 LMP 对比 + 区域价格热力图                             | 热力图 + 柱状图 | 切换 “价格视图”/“利润视图”，对比不同区域卖家收入             |
| 6        | 非快速启动发电机成本回收跟踪（跨时段利润 + 启动成本警戒线）  | 折线图 + 警戒线 | 时间轴滑动查看不同时段利润；未达警戒线时红色闪烁提醒         |
| 7        | 有无成本回收保证的利润对比（分组展示总利润）                 | 双柱状图        | 点击 “补贴明细” 按钮，显示补贴计算过程（启动成本 - 总利润）  |
| 8        | 多时段调度甘特图（标记发电机运行 / 停运状态及最小运行时间约束） | 甘特图          | 拖拽时段边界调整需求，查看调度计划变化                       |
| 9        | 需求预测偏差 + outage 风险导致的价格波动（规划期 vs 实时）   | 折线图 + 误差带 | 勾选 “显示概率分布”，查看需求 / 价格的可能取值范围           |
| 10       | 两阶段结算明细（日前收入 + 实时调整收入）                    | 表格 + 瀑布图   | 输入调整电量（Q_RTM-Q_DAM），实时更新总收入计算结果          |

### 3.5 数据存储与复盘模块

- **存储内容**：课堂会话信息（场景参数、参与人数）、交易记录（时间戳、角色 ID、价格、电量）、结果数据（清算价格、利润、补贴等）。
- **复盘功能**：支持教师回放历史会话的交易过程，查看关键节点（如价格飙升、约束触发）的可视化快照，生成练习报告（含效率分析、问题总结）。

## 四、非功能需求

### 4.1 性能要求

- **响应时间**：单用户操作（如提交报价）响应≤1 秒；30 人同时操作时，可视化更新延迟≤2 秒。
- **数据容量**：单课堂会话数据≤10MB，支持存储 100 + 历史会话（总容量≤1GB）。

### 4.2 易用性要求

- **操作复杂度**：学生角色操作步骤≤3 步（如 “查看 MC→输入报价→提交”）；教师配置场景参数≤5 分钟。
- **帮助系统**：每个场景页面提供 “规则说明” 弹窗（含场景目标、操作指南、示例），关键术语（如 LMP、CMSC）支持 hover 解释。

### 4.3 可靠性要求

- **数据一致性**：并发操作时交易记录不重复 / 丢失；断电重启后可恢复当前会话状态。
- **容错处理**：用户输入无效值（如报价＜MC）时，显示提示信息（“报价需≥边际成本”）并拒绝提交。

### 4.4 扩展性要求

- **模块解耦**：场景逻辑与可视化组件分离，支持新增场景（如 “可再生能源补贴市场”）时仅需开发对应规则与图表。
- **兼容性**：支持 Chrome/Edge/Safari 浏览器；适配 1366×768 及以上分辨率屏幕。

## 五、场景详细设计（按流程分述）

### 5.1 场景启动流程

1. 教师创建会话，选择场景编号（1-10），加载默认参数并修改（如调整需求值、输电容量）。
2. 学生通过会话码加入，教师分配角色（如 “卖家 S1”“买家 B1”），系统向学生展示角色信息（如卖家的 MC、买家的最高支付意愿）。
3. 教师点击 “开始”，系统初始化市场（生成供需列表、渲染初始可视化图表）。

### 5.2 场景运行示例（以场景 3 “输电约束” 为例）

1. **参数配置**：西区 2 个卖家（MC=20、25），东区 2 个卖家（MC=40、50），总需求 = 8MW，输电容量 = 3MW。

2. 交易过程

   ：

   - 卖家提交报价（如 S1=20、S2=25、S3=40、S4=50）。
   - 系统计算无约束时 MCP=25（调度 S1、S2、S3 满足 8MW），但受输电容量限制（仅 3MW 从西区输送至东区），实际调度：西区 S1（2MW）、S2（1MW）；东区 S3（4MW）、S4（1MW）。
   - 可视化实时更新：区域地图标记 S2（约束关闭，红色叉号）、S4（约束开启，黄色感叹号）；价格曲线显示实际调度的 MC（20、25、40、50）与无约束 MCP 的偏差。

3. **结果输出**：生成 “约束前后成本对比表”“卖家利润明细”“消费者额外成本” 等图表，教师可暂停讲解或重启练习。

## 六、测试计划

### 6.1 功能测试

- **场景规则验证**：针对 10 个场景，逐一测试核心逻辑（如场景 4 的 CMSC 计算是否正确 = 报价 - MCP）。
- **边界条件测试**：模拟极端情况（输电容量 = 0、需求突增 100%、outage 概率 = 100%），验证系统是否正常处理（如区域隔离、价格飙升）。

### 6.2 性能测试

- **并发测试**：模拟 30 名学生同时提交报价，监测响应时间（需≤2 秒）及数据一致性（无重复交易）。
- **稳定性测试**：连续运行 10 个场景（每个场景 30 分钟），检查内存占用（≤500MB）及崩溃情况。

### 6.3 易用性测试

- **用户体验调研**：邀请 5 名教师和 20 名学生试用，收集 “操作复杂度”“可视化清晰度” 评分（目标≥4.5/5 分）。
- **说明书验证**：基于用户反馈优化操作手册，确保关键步骤（如场景参数修改、可视化图表解读）清晰易懂。

## 七、交付物

1. **软件包**：可运行的 Web 应用（含前端界面 + 后端服务），支持本地部署。
2. **源代码**：模块化代码（含注释），支持二次开发（如新增场景）。
3. **用户手册**：教师版（场景配置、参数调整）、学生版（角色操作、图表解读）。
4. **测试报告**：含 10 个场景的功能验证结果、性能测试数据、易用性调研分析。

## 八、附录

### 8.1 关键术语表

- **MCP（Market Clearing Price）**：市场清算价格，由供需平衡决定的单一价格（场景 1）。
- **CMSC（Congestion Management Settlement Credits）**：拥堵管理结算补贴，用于补偿输电约束下的卖家（场景 4）。
- **LMP（Locational Marginal Price）**：区域边际价格，反映不同区域的供需差异（场景 5）。

### 8.2 可视化组件开发规范

- 图表配色：低成本 / 正常状态用绿色，高成本 / 约束状态用红色，中性数据用蓝色。
- 交互反馈：所有操作（提交、修改、筛选）需在 0.5 秒内显示动画反馈（如按钮变色、数据刷新闪烁）。

通过以上设计，软件可精准复现 10 个电力市场场景的核心逻辑，借助交互式可视化帮助学生直观理解抽象概念，同时支持教师高效组织课堂模拟，实现 “理论讲解 - 实践操作 - 结果复盘” 的闭环教学。